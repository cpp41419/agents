// @/components/sections/exploitation-machine.tsx
'use client';
import React, { useState } from 'react';
import { cn } from '@/lib/utils';
import { ChevronDown } from 'lucide-react';

const tactics = [
    {
        id: 1,
        emoji: "üéØ",
        title: "The Manufactured Panic Machine",
        tactic: '"Highest and best" deadlines create artificial urgency to force emotional overbidding',
        cost: "5-15% overpayment + $50K in waived inspection repairs",
        type: "problem",
        details: "Real estate agents create false scarcity by setting arbitrary deadlines for 'highest and best' offers. This psychological pressure forces buyers to make emotional decisions, often waiving crucial protections like inspections or appraisal contingencies.",
        impact: "Financial",
        severity: "High"
    },
    {
        id: 2,
        emoji: "üîç",
        title: "Weaponized Ignorance",
        tactic: 'Sellers bury defects via "pre-inspections" and gaslight buyers asking questions',
        cost: "$10K-$100K+ in hidden structural nightmares",
        type: "problem",
        details: "Sellers conduct their own inspections and selectively disclose issues, while making buyers feel unreasonable for requesting additional inspections. This creates a false sense of transparency while hiding major defects.",
        impact: "Financial & Legal",
        severity: "Critical"
    },
    {
        id: 3,
        emoji: "‚öñÔ∏è",
        title: "The Rigged Referee",
        tactic: "Lender-selected appraisers with 20% coming in low, forcing buyers to cover gaps",
        cost: "$5K-$50K in forced cash or lost deposits",
        type: "problem",
        details: "Lenders choose appraisers who often undervalue properties, forcing buyers to either pay the difference in cash or lose their deposit. The system incentivizes conservative appraisals that benefit lenders at buyers' expense.",
        impact: "Financial",
        severity: "High"
    },
    {
        id: 4,
        emoji: "‚è∞",
        title: "The Double-Bind",
        tactic: "Critical disclosures delayed until 48 hours before closing when buyers can't negotiate",
        cost: "$2K-$10K in rushed legal fees to close on time",
        type: "problem",
        details: "Important information is strategically withheld until the last moment when buyers have already committed significant resources and face pressure to close. This timing manipulation prevents meaningful negotiation.",
        impact: "Financial & Time",
        severity: "Medium"
    },
    {
        id: 5,
        emoji: "ü§ù",
        title: "The Invisible Hand",
        tactic: "30% of transactions have dual agents prioritizing commission over client interests",
        cost: "Sellers accept lowballs; buyers overpay",
        type: "problem",
        details: "When one agent represents both buyer and seller, they face inherent conflicts of interest. They're incentivized to close deals quickly rather than get the best outcome for either party, leading to suboptimal results for clients.",
        impact: "Financial & Trust",
        severity: "High"
    },
    {
        id: 6,
        emoji: "üí∞",
        title: "Hidden Cost Avalanche",
        tactic: '"Closing costs" black box with surprise fees appearing at signing',
        cost: "Extra $5K-$15K per transaction with no transparency",
        type: "problem",
        details: "Closing costs are presented as estimates with vague line items. At signing, buyers discover additional fees they can't negotiate, having already committed to the transaction. This lack of transparency enables systematic overcharging.",
        impact: "Financial",
        severity: "Medium"
    },
    {
        id: 7,
        emoji: "üì±",
        title: 'The "Zillow Effect"',
        tactic: "Algorithmic pricing and FOMO marketing from platforms that profit from higher prices",
        cost: '10% overbidding on "hot" homes sitting for months',
        type: "problem",
        details: "Real estate platforms use algorithms to inflate price estimates and create artificial urgency through FOMO marketing. They profit from higher transaction volumes and prices, not buyer satisfaction.",
        impact: "Market Distortion",
        severity: "High"
    },
    {
        id: 8,
        emoji: "‚ö†Ô∏è",
        title: "Legal Traps",
        tactic: '"As-is" clauses slip into contracts, stripping buyers of recourse for undisclosed defects',
        cost: "$20K+ lawsuits that take years to resolve",
        type: "problem",
        details: "Contracts include 'as-is' language that seems standard but actually removes buyer protections for undisclosed defects. When problems arise, buyers face expensive legal battles with uncertain outcomes.",
        impact: "Legal & Financial",
        severity: "Critical"
    }
];

const solutions = [
    {
        id: 9,
        emoji: "üîç",
        title: "Mandatory Pre-Inspection Transparency",
        tactic: "Sellers must disclose all known defects 7 days before listing‚Äîor face treble damages",
        cost: "Prevents $10K-$100K+ in hidden surprises",
        type: "solution",
        details: "Require sellers to conduct and fully disclose professional inspections before listing. Any undisclosed defects discovered later result in triple damages, creating strong incentives for complete transparency.",
        impact: "Regulatory",
        benefit: "High"
    },
    {
        id: 10,
        emoji: "üëÅÔ∏è",
        title: "Blind Bidding Ban",
        tactic: "All offers revealed simultaneously (like in Australia) to kill phantom bidding wars",
        cost: "Eliminates 5-15% artificial inflation",
        type: "solution",
        details: "Adopt Australia's transparent bidding system where all offers are visible to participants. This eliminates fake bidding wars and phantom competing offers that drive up prices artificially.",
        impact: "Market Reform",
        benefit: "High"
    },
    {
        id: 11,
        emoji: "üèõÔ∏è",
        title: "Appraisal Independence",
        tactic: "Buyers hire appraisers directly, funded via escrow‚Äîno lender influence",
        cost: "Prevents $5K-$50K gaps and manipulation",
        type: "solution",
        details: "Remove lender influence from appraisals by having buyers select appraisers directly, with costs managed through escrow. This eliminates conflicts of interest and provides more accurate valuations.",
        impact: "Process Reform",
        benefit: "Medium"
    },
    {
        id: 12,
        emoji: "üßæ",
        title: "Closing Cost Caps",
        tactic: "Regulate junk fees and require upfront estimates with legal binding",
        cost: "Saves $5K-$15K in surprise fees",
        type: "solution",
        details: "Cap closing costs at reasonable percentages and make initial estimates legally binding. Prohibit junk fees and require detailed, transparent cost breakdowns from the beginning.",
        impact: "Regulatory",
        benefit: "Medium"
    },
    {
        id: 13,
        emoji: "‚öñÔ∏è",
        title: "Agent Fiduciary Duty",
        tactic: "Make dual agency illegal‚Äîagents must act solely for their client's best interest",
        cost: "Ensures true representation and fair deals",
        type: "solution",
        details: "Prohibit dual agency arrangements and strengthen fiduciary duty requirements. Agents must demonstrate they're acting solely in their client's best interest, with severe penalties for violations.",
        impact: "Legal Reform",
        benefit: "High"
    },
    {
        id: 14,
        emoji: "üìä",
        title: "Full Information Transparency",
        tactic: "MLS data must be public, with complete transaction histories visible to all",
        cost: "Eliminates information asymmetry advantage",
        type: "solution",
        details: "Make all MLS data publicly accessible and require complete transaction histories to be visible. This levels the playing field and eliminates the information advantage professionals hold over consumers.",
        impact: "Information Democracy",
        benefit: "Critical"
    }
];

const allCardsData = [...tactics, ...solutions];

export default function ExploitationMachine() {
    const [filter, setFilter] = useState('all');
    const [expandedCards, setExpandedCards] = useState<Record<number, boolean>>({});

    const handleToggleCard = (id: number) => {
        setExpandedCards(prev => ({ ...prev, [id]: !prev[id] }));
    };

    const getFilteredCards = () => {
        switch (filter) {
            case 'problems':
                return tactics;
            case 'solutions':
                return solutions;
            default:
                return allCardsData;
        }
    };

    const cardsToShow = getFilteredCards();

    return (
        <div className="exploitation-body">
            <header className="exploitation-header">
                <div className="container">
                    <h1>üè† The Real Estate Exploitation Machine</h1>
                    <p className="subtitle">How the System is Designed to Extract Value While Keeping You in the Dark</p>
                    <p className="description">
                        The real structural pain points aren't about e-signatures or apps‚Äîthey're about information asymmetry baked into every step of the transaction.
                    </p>
                </div>
            </header>

            <div className="container">
                <div className="filter-controls">
                    <div className="filter-buttons">
                        <button onClick={() => setFilter('all')} className={cn('filter-btn', { active: filter === 'all' })}>Show All</button>
                        <button onClick={() => setFilter('problems')} className={cn('filter-btn', { active: filter === 'problems' })}>Exploitation Tactics ({tactics.length})</button>
                        <button onClick={() => setFilter('solutions')} className={cn('filter-btn', { active: filter === 'solutions' })}>Real Fixes ({solutions.length})</button>
                    </div>
                </div>
            </div>

            <main className="container">
                <div className="cards-grid">
                    {cardsToShow.map((item, index) => {
                        const isExpanded = !!expandedCards[item.id];
                        const costClass = item.type === 'solution' ? 'cost-solution' : 'cost-problem';
                        const badgeClass = item.type === 'solution' ? 'badge-solution' : 'badge-problem';
                        const badgeText = item.type === 'solution' ? 'Fix' : `#${item.id}`;

                        return (
                            <div
                                key={item.id}
                                className={cn('card', item.type)}
                                style={{ animationDelay: `${index * 0.05}s` }}
                                onClick={() => handleToggleCard(item.id)}
                            >
                                <div className="card-header">
                                    <div className="card-emoji">{item.emoji}</div>
                                    <div className="card-title-area">
                                        <div className="card-title-row">
                                            <h3 className="card-title">{item.title}</h3>
                                            <span className={cn('card-badge', badgeClass)}>{badgeText}</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="card-tactic">
                                    <p className="label">{item.type === 'problem' ? 'The Tactic:' : 'The Solution:'}</p>
                                    <p className="text">{item.tactic}</p>
                                </div>

                                <div className="card-cost">
                                    <p className={costClass}>üí∞ {item.cost}</p>
                                </div>

                                {isExpanded && (
                                    <div className={cn('details-section', isExpanded ? 'animate-slide-up' : '')}>
                                        <p className="details-text">{item.details}</p>
                                        <div className="tags">
                                            <span className="tag">Impact: {item.impact}</span>
                                            {item.severity && <span className={cn('tag', 'severity')}>Severity: {item.severity}</span>}
                                            {item.benefit && <span className={cn('tag', 'benefit')}>Benefit: {item.benefit}</span>}
                                        </div>
                                    </div>
                                )}

                                <div className="card-footer">
                                    <div className="expand-text">Click to expand details</div>
                                    <ChevronDown className={cn('expand-arrow', { rotated: isExpanded })} />
                                </div>
                            </div>
                        );
                    })}
                </div>
            </main>

            <footer className="exploitation-footer">
                <div className="container">
                    <h3>üí° The Bottom Line</h3>
                    <p>
                        The industry's core rot isn't tech‚Äîit's information asymmetry. Until consumers can see the game, they'll keep losing it.
                    </p>
                </div>
            </footer>
        </div>
    );
}